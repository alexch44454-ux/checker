<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–®–∞—à–∫–∏ - Telegram Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }
        
        .game-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }
        
        .game-container.hidden {
            display: none;
        }
        
        .game-info {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: bold;
        }
        
        .current-player {
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .current-player.white {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        
        .current-player.black {
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
        }
        
        .checkers-board {
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            border: 4px solid #8b4513;
            background: #d4a574;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border-radius: 5px;
        }
        
        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .cell.light {
            background: #f0d9b5;
        }
        
        .cell.dark {
            background: #b58863;
        }
        
        .cell.dark:hover {
            background: #c49f7a;
        }
        
        .cell.selected {
            background: #ffd700 !important;
            box-shadow: inset 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .cell.possible-move {
            background: #90ee90 !important;
            box-shadow: inset 0 0 15px rgba(144, 238, 144, 0.5);
        }
        
        .cell.possible-capture {
            background: #ff6b6b !important;
            box-shadow: inset 0 0 15px rgba(255, 107, 107, 0.5);
        }
        
        .piece {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .piece.white {
            background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%);
            color: #333;
            border: 3px solid #ccc;
        }
        
        .piece.black {
            background: linear-gradient(135deg, #2c2c2c 0%, #000000 100%);
            color: #fff;
            border: 3px solid #1a1a1a;
        }
        
        .piece.king::after {
            content: '‚ôî';
            font-size: 0.6em;
            position: absolute;
        }
        
        .piece.white.king {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: 3px solid #ffb300;
        }
        
        .piece.black.king {
            background: linear-gradient(135deg, #8b4513 0%, #654321 100%);
            border: 3px solid #5a2d0c;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        /* –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ */
        .mode-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .mode-menu {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .mode-menu h2 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #fff;
        }
        
        .mode-menu p {
            margin-bottom: 20px;
            color: #ccc;
        }
        
        .mode-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .mode-btn {
            padding: 15px 25px;
            font-size: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }
        
        .mode-icon {
            font-size: 24px;
        }
        
        /* –ú–µ–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞ */
        .bot-difficulty-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }
        
        .bot-difficulty-menu {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .difficulty-slider {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            margin: 20px 0;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .difficulty-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }
        
        .difficulty-slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            border: none;
        }
        
        .difficulty-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .difficulty-description {
            color: #ccc;
            margin-bottom: 20px;
            min-height: 40px;
        }
        
        .game-over-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .game-over-menu {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .game-over-menu h2 {
            font-size: 32px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ -->
    <div class="mode-menu-overlay" id="modeMenuOverlay" style="display: flex;">
        <div class="mode-menu">
            <h2>‚ö´ –®–∞—à–∫–∏</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∏–≥—Ä—ã:</p>
            <div class="mode-buttons">
                <button class="mode-btn" onclick="showBotDifficultyMenu()">
                    <span class="mode-icon">ü§ñ</span>
                    <span class="mode-text">–ò–≥—Ä–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–∞</span>
                </button>
                <button class="mode-btn" onclick="selectMode('pvp')">
                    <span class="mode-icon">üë•</span>
                    <span class="mode-text">–î–≤–∞ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞ -->
    <div class="bot-difficulty-overlay" id="botDifficultyOverlay">
        <div class="bot-difficulty-menu">
            <h2>ü§ñ –°–ª–æ–∂–Ω–æ—Å—Ç—å –±–æ—Ç–∞</h2>
            <div class="difficulty-value" id="difficultyValue">5</div>
            <div class="difficulty-description" id="difficultyDescription">–°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å</div>
            <input type="range" min="1" max="10" value="5" class="difficulty-slider" id="difficultySlider" oninput="updateDifficultyDisplay()">
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="startGameWithBot()" style="flex: 1;">–ò–≥—Ä–∞—Ç—å</button>
                <button onclick="hideBotDifficultyMenu()" style="flex: 1; background: rgba(255, 0, 0, 0.3);">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <!-- –ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="game-container" id="gameContainer">
        <div class="game-info">
            <div class="current-player white" id="currentPlayer">–•–æ–¥: –ë–µ–ª—ã–µ</div>
        </div>
        <div class="checkers-board" id="checkersBoard"></div>
        <div class="controls">
            <button onclick="resetGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            <button onclick="showModeMenu()">–ú–µ–Ω—é</button>
        </div>
    </div>
    
    <!-- –û–≤–µ—Ä–ª–µ–π –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã -->
    <div class="game-over-overlay" id="gameOverOverlay">
        <div class="game-over-menu">
            <h2 id="gameOverTitle">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
            <p id="gameOverMessage"></p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="resetGame()" style="flex: 1;">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                <button onclick="showModeMenu()" style="flex: 1;">–ú–µ–Ω—é</button>
            </div>
        </div>
    </div>
    
    <script>
        // Telegram WebApp API
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let board = [];
        let currentPlayer = 'white'; // 'white' –∏–ª–∏ 'black'
        let selectedCell = null;
        let possibleMoves = [];
        let gameMode = null; // 'bot', 'pvp', 'online'
        let botDifficulty = 5; // 1-10
        let gameOver = false;
        const BOARD_SIZE = 8;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å–∫–∏
        function initBoard() {
            board = [];
            for (let row = 0; row < BOARD_SIZE; row++) {
                board[row] = [];
                for (let col = 0; col < BOARD_SIZE; col++) {
                    board[row][col] = null;
                }
            }
            
            // –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–µ–ª—ã—Ö —Ñ–∏—à–µ–∫ (–≤–Ω–∏–∑—É)
            for (let row = 5; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    if ((row + col) % 2 === 1) {
                        board[row][col] = { type: 'white', king: false };
                    }
                }
            }
            
            // –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–Ω—ã—Ö —Ñ–∏—à–µ–∫ (–≤–≤–µ—Ä—Ö—É)
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    if ((row + col) % 2 === 1) {
                        board[row][col] = { type: 'black', king: false };
                    }
                }
            }
            
            renderBoard();
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–æ—Å–∫–∏
        function renderBoard() {
            const boardElement = document.getElementById('checkersBoard');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.classList.add((row + col) % 2 === 0 ? 'light' : 'dark');
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏—à–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
                    const piece = board[row][col];
                    if (piece) {
                        const pieceElement = document.createElement('div');
                        pieceElement.className = `piece ${piece.type}`;
                        if (piece.king) {
                            pieceElement.classList.add('king');
                        }
                        cell.appendChild(pieceElement);
                    }
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                    if ((row + col) % 2 === 1) { // –¢–æ–ª—å–∫–æ —á–µ—Ä–Ω—ã–µ –∫–ª–µ—Ç–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
                        cell.addEventListener('click', () => handleCellClick(row, col));
                    }
                    
                    boardElement.appendChild(cell);
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã
            updateCellStyles();
            updateCurrentPlayerDisplay();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∫–ª–µ—Ç–æ–∫
        function updateCellStyles() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.classList.remove('selected', 'possible-move', 'possible-capture');
            });
            
            if (selectedCell) {
                const { row, col } = selectedCell;
                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.classList.add('selected');
                }
                
                possibleMoves.forEach(move => {
                    const cell = document.querySelector(`[data-row="${move.toRow}"][data-col="${move.toCol}"]`);
                    if (cell) {
                        if (move.isCapture) {
                            cell.classList.add('possible-capture');
                        } else {
                            cell.classList.add('possible-move');
                        }
                    }
                });
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        function updateCurrentPlayerDisplay() {
            const currentPlayerEl = document.getElementById('currentPlayer');
            if (currentPlayerEl) {
                currentPlayerEl.textContent = `–•–æ–¥: ${currentPlayer === 'white' ? '–ë–µ–ª—ã–µ' : '–ß–µ—Ä–Ω—ã–µ'}`;
                currentPlayerEl.className = `current-player ${currentPlayer}`;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ
        function handleCellClick(row, col) {
            if (gameOver) return;
            
            const piece = board[row][col];
            
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ —Ñ–∏—à–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            if (piece && piece.type === currentPlayer) {
                selectedCell = { row, col };
                possibleMoves = getPossibleMoves(row, col);
                renderBoard();
            }
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–ª–µ—Ç–∫–∞ –¥–ª—è —Ö–æ–¥–∞
            else if (selectedCell) {
                const move = possibleMoves.find(m => m.toRow === row && m.toCol === col);
                if (move) {
                    makeMove(selectedCell.row, selectedCell.col, row, col);
                    selectedCell = null;
                    possibleMoves = [];
                    renderBoard();
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
                    if (!gameOver) {
                        checkGameOver();
                        if (!gameOver && gameMode === 'bot' && currentPlayer === 'black') {
                            setTimeout(() => makeBotMove(), 500);
                        }
                    }
                } else {
                    // –û—Ç–º–µ–Ω—è–µ–º –≤—ã–±–æ—Ä
                    selectedCell = null;
                    possibleMoves = [];
                    renderBoard();
                }
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤ –¥–ª—è —Ñ–∏—à–∫–∏
        function getPossibleMoves(row, col) {
            const piece = board[row][col];
            if (!piece) return [];
            
            const moves = [];
            const captures = [];
            
            // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –æ–±—ã—á–Ω–æ–π —Ñ–∏—à–∫–∏
            const directions = piece.king 
                ? [[-1, -1], [-1, 1], [1, -1], [1, 1]] // –î–∞–º–∫–∞ –º–æ–∂–µ—Ç –≤–æ –≤—Å–µ —Å—Ç–æ—Ä–æ–Ω—ã
                : piece.type === 'white' 
                    ? [[-1, -1], [-1, 1]] // –ë–µ–ª—ã–µ –∏–¥—É—Ç –≤–≤–µ—Ä—Ö
                    : [[1, -1], [1, 1]]; // –ß–µ—Ä–Ω—ã–µ –∏–¥—É—Ç –≤–Ω–∏–∑
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ã—á–Ω—ã–µ —Ö–æ–¥—ã –∏ –≤–∑—è—Ç–∏—è
            for (const [dr, dc] of directions) {
                if (piece.king) {
                    // –î–ª—è –¥–∞–º–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏
                    for (let i = 1; i < BOARD_SIZE; i++) {
                        const newRow = row + dr * i;
                        const newCol = col + dc * i;
                        
                        if (!isValidCell(newRow, newCol)) break;
                        
                        const targetPiece = board[newRow][newCol];
                        if (!targetPiece) {
                            moves.push({ toRow: newRow, toCol: newCol, isCapture: false });
                        } else if (targetPiece.type !== piece.type) {
                            // –í–æ–∑–º–æ–∂–Ω–æ–µ –≤–∑—è—Ç–∏–µ
                            const jumpRow = newRow + dr;
                            const jumpCol = newCol + dc;
                            if (isValidCell(jumpRow, jumpCol) && !board[jumpRow][jumpCol]) {
                                captures.push({ 
                                    toRow: jumpRow, 
                                    toCol: jumpCol, 
                                    isCapture: true,
                                    captureRow: newRow,
                                    captureCol: newCol
                                });
                            }
                            break;
                        } else {
                            break;
                        }
                    }
                } else {
                    // –î–ª—è –æ–±—ã—á–Ω–æ–π —Ñ–∏—à–∫–∏
                    const newRow = row + dr;
                    const newCol = col + dc;
                    
                    if (isValidCell(newRow, newCol)) {
                        const targetPiece = board[newRow][newCol];
                        if (!targetPiece) {
                            moves.push({ toRow: newRow, toCol: newCol, isCapture: false });
                        } else if (targetPiece.type !== piece.type) {
                            // –í–æ–∑–º–æ–∂–Ω–æ–µ –≤–∑—è—Ç–∏–µ
                            const jumpRow = newRow + dr;
                            const jumpCol = newCol + dc;
                            if (isValidCell(jumpRow, jumpCol) && !board[jumpRow][jumpCol]) {
                                captures.push({ 
                                    toRow: jumpRow, 
                                    toCol: jumpCol, 
                                    isCapture: true,
                                    captureRow: newRow,
                                    captureCol: newCol
                                });
                            }
                        }
                    }
                }
            }
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –≤–∑—è—Ç–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –∏—Ö (–≤–∑—è—Ç–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)
            return captures.length > 0 ? captures : moves;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –∫–ª–µ—Ç–∫–∏
        function isValidCell(row, col) {
            return row >= 0 && row < BOARD_SIZE && col >= 0 && col < BOARD_SIZE;
        }
        
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞
        function makeMove(fromRow, fromCol, toRow, toCol) {
            const piece = board[fromRow][fromCol];
            if (!piece) return false;
            
            const move = possibleMoves.find(m => m.toRow === toRow && m.toCol === toCol);
            if (!move) return false;
            
            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏—à–∫—É
            board[toRow][toCol] = piece;
            board[fromRow][fromCol] = null;
            
            // –ï—Å–ª–∏ —ç—Ç–æ –≤–∑—è—Ç–∏–µ, —É–¥–∞–ª—è–µ–º –≤–∑—è—Ç—É—é —Ñ–∏—à–∫—É
            if (move.isCapture) {
                board[move.captureRow][move.captureCol] = null;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –≤–∑—è—Ç–∏—è
                const continueCaptures = getPossibleMoves(toRow, toCol).filter(m => m.isCapture);
                if (continueCaptures.length > 0) {
                    // –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤–∑—è—Ç–∏–µ
                    selectedCell = { row: toRow, col: toCol };
                    possibleMoves = continueCaptures;
                    renderBoard();
                    return true; // –ù–µ –º–µ–Ω—è–µ–º –∏–≥—Ä–æ–∫–∞
                }
            }
            
            // –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –¥–∞–º–∫—É
            if (!piece.king) {
                if ((piece.type === 'white' && toRow === 0) || 
                    (piece.type === 'black' && toRow === BOARD_SIZE - 1)) {
                    piece.king = true;
                }
            }
            
            // –ú–µ–Ω—è–µ–º –∏–≥—Ä–æ–∫–∞
            currentPlayer = currentPlayer === 'white' ? 'black' : 'white';
            selectedCell = null;
            possibleMoves = [];
            
            return true;
        }
        
        // –•–æ–¥ –±–æ—Ç–∞
        function makeBotMove() {
            if (gameOver || currentPlayer !== 'black') return;
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã —á–µ—Ä–Ω—ã—Ö
            const allMoves = [];
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    const piece = board[row][col];
                    if (piece && piece.type === 'black') {
                        const moves = getPossibleMoves(row, col);
                        moves.forEach(move => {
                            allMoves.push({
                                fromRow: row,
                                fromCol: col,
                                toRow: move.toRow,
                                toCol: move.toCol,
                                isCapture: move.isCapture,
                                captureRow: move.captureRow,
                                captureCol: move.captureCol
                            });
                        });
                    }
                }
            }
            
            if (allMoves.length === 0) {
                endGame('white');
                return;
            }
            
            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤–∑—è—Ç–∏—è–º
            const captures = allMoves.filter(m => m.isCapture);
            const movesToConsider = captures.length > 0 ? captures : allMoves;
            
            // –í—ã–±–æ—Ä —Ö–æ–¥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            let selectedMove;
            if (botDifficulty <= 3) {
                // –õ–µ–≥–∫–∏–π: —Å–ª—É—á–∞–π–Ω—ã–π —Ö–æ–¥
                selectedMove = movesToConsider[Math.floor(Math.random() * movesToConsider.length)];
            } else if (botDifficulty <= 6) {
                // –°—Ä–µ–¥–Ω–∏–π: –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –≤–∑—è—Ç–∏—è, –∏–Ω–æ–≥–¥–∞ —Å–ª—É—á–∞–π–Ω—ã–π
                if (captures.length > 0 && Math.random() < 0.8) {
                    selectedMove = captures[Math.floor(Math.random() * captures.length)];
                } else {
                    selectedMove = movesToConsider[Math.floor(Math.random() * movesToConsider.length)];
                }
            } else {
                // –°–ª–æ–∂–Ω—ã–π: –≤—Å–µ–≥–¥–∞ –±–µ—Ä–µ—Ç, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ, –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–π —Ö–æ–¥
                if (captures.length > 0) {
                    // –í—ã–±–∏—Ä–∞–µ–º –≤–∑—è—Ç–∏–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
                    selectedMove = captures[0];
                } else {
                    // –í—ã–±–∏—Ä–∞–µ–º —Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç –∫ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏—é –≤ –¥–∞–º–∫—É
                    selectedMove = movesToConsider.reduce((best, move) => {
                        const piece = board[move.fromRow][move.fromCol];
                        if (!piece.king) {
                            const progress = piece.type === 'black' 
                                ? (BOARD_SIZE - 1 - move.toRow) 
                                : move.toRow;
                            const bestProgress = piece.type === 'black'
                                ? (BOARD_SIZE - 1 - best.toRow)
                                : best.toRow;
                            return progress > bestProgress ? move : best;
                        }
                        return best;
                    }, movesToConsider[0]);
                }
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Ö–æ–¥
            selectedCell = { row: selectedMove.fromRow, col: selectedMove.fromCol };
            possibleMoves = getPossibleMoves(selectedMove.fromRow, selectedMove.fromCol);
            makeMove(selectedMove.fromRow, selectedMove.fromCol, selectedMove.toRow, selectedMove.toCol);
            renderBoard();
            
            checkGameOver();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
        function checkGameOver() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã
            let hasMoves = false;
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    const piece = board[row][col];
                    if (piece && piece.type === currentPlayer) {
                        const moves = getPossibleMoves(row, col);
                        if (moves.length > 0) {
                            hasMoves = true;
                            break;
                        }
                    }
                }
                if (hasMoves) break;
            }
            
            if (!hasMoves) {
                const winner = currentPlayer === 'white' ? 'black' : 'white';
                endGame(winner);
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∏—à–µ–∫
            let whiteCount = 0;
            let blackCount = 0;
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    const piece = board[row][col];
                    if (piece) {
                        if (piece.type === 'white') whiteCount++;
                        else blackCount++;
                    }
                }
            }
            
            if (whiteCount === 0) {
                endGame('black');
            } else if (blackCount === 0) {
                endGame('white');
            }
        }
        
        // –û–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã
        function endGame(winner) {
            gameOver = true;
            const overlay = document.getElementById('gameOverOverlay');
            const title = document.getElementById('gameOverTitle');
            const message = document.getElementById('gameOverMessage');
            
            if (overlay && title && message) {
                title.textContent = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!';
                message.textContent = `–ü–æ–±–µ–¥–∏–ª–∏ ${winner === 'white' ? '–ë–µ–ª—ã–µ' : '–ß–µ—Ä–Ω—ã–µ'}!`;
                overlay.style.display = 'flex';
            }
        }
        
        // –°–±—Ä–æ—Å –∏–≥—Ä—ã
        function resetGame() {
            gameOver = false;
            currentPlayer = 'white';
            selectedCell = null;
            possibleMoves = [];
            const overlay = document.getElementById('gameOverOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
            initBoard();
        }
        
        // –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –∏–≥—Ä—ã
        function selectMode(mode) {
            const modeMenuOverlay = document.getElementById('modeMenuOverlay');
            if (modeMenuOverlay) {
                modeMenuOverlay.style.display = 'none';
            }
            gameMode = mode;
            const gameContainer = document.getElementById('gameContainer');
            if (gameContainer) {
                gameContainer.classList.remove('hidden');
            }
            resetGame();
            if (mode === 'pvp') {
                currentPlayer = 'white';
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —Ä–µ–∂–∏–º–æ–≤
        function showModeMenu() {
            const modeMenuOverlay = document.getElementById('modeMenuOverlay');
            const gameContainer = document.getElementById('gameContainer');
            if (modeMenuOverlay) {
                modeMenuOverlay.style.display = 'flex';
            }
            if (gameContainer) {
                gameContainer.classList.add('hidden');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞
        function showBotDifficultyMenu() {
            const overlay = document.getElementById('botDifficultyOverlay');
            if (overlay) {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å
                try {
                    const saved = localStorage.getItem('checkers_bot_difficulty');
                    if (saved) {
                        botDifficulty = parseInt(saved) || 5;
                        document.getElementById('difficultySlider').value = botDifficulty;
                    }
                } catch (e) {
                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏–∑ localStorage');
                }
                updateDifficultyDisplay();
                overlay.style.display = 'flex';
            }
        }
        
        // –°–∫—Ä—ã—Ç—å –º–µ–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞
        function hideBotDifficultyMenu() {
            const overlay = document.getElementById('botDifficultyOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        function updateDifficultyDisplay() {
            const slider = document.getElementById('difficultySlider');
            const valueEl = document.getElementById('difficultyValue');
            const descEl = document.getElementById('difficultyDescription');
            
            if (slider && valueEl && descEl) {
                botDifficulty = parseInt(slider.value);
                valueEl.textContent = botDifficulty;
                
                let description = '';
                if (botDifficulty <= 2) {
                    description = '–û—á–µ–Ω—å –ª–µ–≥–∫–æ';
                } else if (botDifficulty <= 4) {
                    description = '–õ–µ–≥–∫–æ';
                } else if (botDifficulty <= 6) {
                    description = '–°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å';
                } else if (botDifficulty <= 8) {
                    description = '–°–ª–æ–∂–Ω–æ';
                } else {
                    description = '–û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ';
                }
                
                descEl.textContent = description;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                try {
                    localStorage.setItem('checkers_bot_difficulty', botDifficulty.toString());
                } catch (e) {
                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤ localStorage');
                }
            }
        }
        
        // –ù–∞—á–∞—Ç—å –∏–≥—Ä—É —Å –±–æ—Ç–æ–º
        function startGameWithBot() {
            hideBotDifficultyMenu();
            selectMode('bot');
            currentPlayer = 'white';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const modeParam = urlParams.get('mode');
            
            if (modeParam) {
                gameMode = modeParam;
                const modeMenuOverlay = document.getElementById('modeMenuOverlay');
                if (modeMenuOverlay) {
                    modeMenuOverlay.style.display = 'none';
                }
                const gameContainer = document.getElementById('gameContainer');
                if (gameContainer) {
                    gameContainer.classList.remove('hidden');
                }
                if (modeParam === 'bot') {
                    showBotDifficultyMenu();
                }
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
                const modeMenuOverlay = document.getElementById('modeMenuOverlay');
                if (modeMenuOverlay) {
                    modeMenuOverlay.style.display = 'flex';
                }
                const gameContainer = document.getElementById('gameContainer');
                if (gameContainer) {
                    gameContainer.classList.add('hidden');
                }
            }
            
            initBoard();
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
